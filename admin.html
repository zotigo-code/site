<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
        #adminForm {
            display: none; /* Hide the form until the correct password is entered */
        }
    </style>
</head>
<body>
    <!-- Editable Heading Section -->
    <div id="editableHeading">
        <input type="text" id="headingInput" placeholder="Enter heading for the page" />
        <button type="button" onclick="saveHeading()">Save</button>
    </div>
    <h1 id="pageHeading" onclick="editHeading()">Set the page heading</h1>
    
    <!-- Password Prompt -->
    <div id="passwordPrompt">
        <label for="password">Enter Password:</label>
        <input type="password" id="password" required />
        <button type="button" onclick="validatePassword()">Submit</button>
    </div>

    <!-- Admin Panel Form -->
    <form id="adminForm">
        <label for="loftDropdown">Loft:</label>
        <select id="loftDropdown">
            <!-- Dropdown options will be dynamically populated -->
        </select>

        <label for="pigeonNumber">Next Pigeon Number:</label>
        <input type="text" id="pigeonNumber" disabled />

        <label for="timeEntry">Time (HH:MM:SS):</label>
        <input type="time" id="timeEntry" step="1" value="00:00:00" required />

        <button type="button" onclick="saveData()">Save</button>

        <hr />

        <label for="uraanTime">Uraan Ka Time:</label>
        <input type="time" id="uraanTime" step="1" value="00:00:00" />
        <button type="button" onclick="applyUraanTime()">Apply to All</button>
    </form>

    <script>
        // Load tableData from localStorage or initialise with default values
        let tableData = JSON.parse(localStorage.getItem("tableData")) || Array.from({ length: 10 }, (_, i) => ({
            loft: `Loft ${i + 1}`,
            times: ["00:00:00", "00:00:00", "00:00:00", "00:00:00", "00:00:00", "00:00:00", "00:00:00"],
            total: 0,
            uraanKaTime: null,
        }));

        // Function to save tableData to localStorage
        function saveToLocalStorage() {
            localStorage.setItem("tableData", JSON.stringify(tableData));
        }

        // Function to validate password before showing the form
        function validatePassword() {
            const passwordInput = document.getElementById("password");
            const adminForm = document.getElementById("adminForm");
            const passwordPrompt = document.getElementById("passwordPrompt");

            const correctPassword = "admin123"; // Replace with your desired password

            if (passwordInput.value === correctPassword) {
                passwordPrompt.style.display = "none"; // Hide the password prompt
                adminForm.style.display = "block"; // Show the admin form
                populateLoftDropdown(); // Populate the Loft dropdown
            } else {
                alert("Incorrect password. Please try again.");
            }
        }

        // Function to enable editing of the heading
        function editHeading() {
            const headingDisplay = document.getElementById("pageHeading");
            const headingEdit = document.getElementById("editableHeading");
            const headingInput = document.getElementById("headingInput");

            headingInput.value = headingDisplay.textContent;
            headingDisplay.style.display = "none";
            headingEdit.style.display = "block";
        }

        // Function to save and display the heading
        function saveHeading() {
            const headingDisplay = document.getElementById("pageHeading");
            const headingEdit = document.getElementById("editableHeading");
            const headingInput = document.getElementById("headingInput");

            headingDisplay.textContent = headingInput.value || "Set the page heading";
            headingDisplay.style.display = "block";
            headingEdit.style.display = "none";
        }

        // Function to populate the Loft dropdown menu
        function populateLoftDropdown() {
            const dropdown = document.getElementById("loftDropdown");
            dropdown.innerHTML = ""; // Reset dropdown
            tableData.forEach((row, index) => {
                const option = document.createElement("option");
                option.value = index;
                option.textContent = row.loft;
                dropdown.appendChild(option);
            });

            updateNextPigeonNumber();
        }

        // Function to update the next pigeon number for the selected loft
        function updateNextPigeonNumber() {
            const selectedLoftIndex = document.getElementById("loftDropdown").value;
            const selectedLoft = tableData[selectedLoftIndex];

            // Find the next available pigeon slot
            const nextPigeonIndex = selectedLoft.times.findIndex(time => time === "00:00:00");
            const nextPigeon = nextPigeonIndex !== -1 ? nextPigeonIndex + 1 : "Full";

            // Update the pigeon number field
            document.getElementById("pigeonNumber").value = nextPigeon;
        }

        // Function to save data for a specific loft and pigeon
        function saveData() {
            const selectedLoftIndex = parseInt(document.getElementById("loftDropdown").value);
            const timeEntry = document.getElementById("timeEntry").value;

            if (!timeEntry || selectedLoftIndex < 0) {
                alert("Please enter a valid time and select a loft.");
                return;
            }

            const selectedLoft = tableData[selectedLoftIndex];
            const nextPigeonIndex = selectedLoft.times.findIndex(time => time === "00:00:00");

            if (nextPigeonIndex !== -1) {
                // Save the time in the next available pigeon slot
                selectedLoft.times[nextPigeonIndex] = timeEntry;

                alert(`Time saved for ${selectedLoft.loft}, Pigeon ${nextPigeonIndex + 1}`);

                // Save the updated data to localStorage
                saveToLocalStorage();

                // Update the next pigeon number
                updateNextPigeonNumber();
            } else {
                alert("All pigeon slots for this loft are full.");
            }
        }

        // Function to apply "Uraan Ka Time" to all lofts
        function applyUraanTime() {
            const uraanTime = document.getElementById("uraanTime").value;

            if (!uraanTime) {
                alert("Please enter a valid Uraan Ka Time.");
                return;
            }

            tableData.forEach(row => {
                row.uraanKaTime = uraanTime;

                // Adjust times (logic for subtraction can be added here)
                row.times = row.times.map(time => {
                    if (time !== "00:00:00") {
                        return time; // Placeholder: Keeping the same time for now
                    }
                    return time;
                });
            });

            // Save the updated data to localStorage
            saveToLocalStorage();

            alert("Uraan Ka Time applied to all lofts.");
        }

        // Populate dropdown on page load
        document.addEventListener("DOMContentLoaded", populateLoftDropdown);
    </script>
</body>
</html>
