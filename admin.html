<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; padding:20px; }
    .hidden { display:none; }
    label { display:block; margin-top:10px; }
    input, select, button { margin:5px 0; padding:5px; }
  </style>
</head>
<body>
  <!-- Login Section -->
  <div id="loginSection">
    <h2>Admin Login</h2>
    <label for="adminPassword">Password:</label>
    <input type="password" id="adminPassword">
    <button id="loginBtn">Login</button>
    <button id="setPasswordBtn">Set Password</button>
  </div>

  <!-- Admin Form Section -->
  <div id="formSection" class="hidden">
    <h2>Admin Panel</h2>

    <h3>Set Tournament Config</h3>
    <form id="configForm">
      <label>Number of Pigeons:<input type="number" id="numPigeons"></label>
      <button type="submit">Save Config</button>
    </form>

    <h3>Set Page Heading</h3>
    <input type="text" id="pageHeadingInput" placeholder="Enter page heading">
    <button id="saveHeadingBtn">Save Heading</button>

    <h3>Upload Top Image</h3>
    <input type="file" id="topImageInput" accept="image/*">
    <button id="saveImageBtn">Save Image</button>

    <h3>Set Sab Lofts Ka Uraan Ka Time</h3>
    <input type="text" id="uraanKaTimeInput" placeholder="HHMMSS">
    <button id="setUraanTimeBtn">Apply</button>

    <h3>Time Registration</h3>
    <label for="nameSelect">Name:</label>
    <select id="nameSelect"></select>

    <label for="uraanTimeByName">Uraan Ka Time:</label>
    <input type="text" id="uraanTimeByName" placeholder="HHMMSS">
    <button type="button" id="applyUraanTimeByNameBtn">Apply Uraan Time</button>

    <label for="pigeonTime">Pigeon Time:</label>
    <input type="text" id="pigeonTime" placeholder="HHMMSS">
    <button id="saveTimeBtn">Save Time</button>

    <h3>Add Row</h3>
    <form id="addRowForm">
      <label>Name:<input type="text" id="rowName"></label>
      <button type="submit">Add Row</button>
    </form>
  </div>

  <script>
    function autoFormatTime(input){
      input.addEventListener("input", ()=>{
        let v=input.value.replace(/\D/g,"").slice(0,6);
        if(v.length>=4){ v=v.replace(/(\d{2})(\d{2})(\d{0,2})/,"$1:$2:$3"); }
        else if(v.length>=2){ v=v.replace(/(\d{2})(\d{0,2})/,"$1:$2"); }
        input.value=v;
      });
    }

    autoFormatTime(document.getElementById("uraanKaTimeInput"));
    autoFormatTime(document.getElementById("pigeonTime"));
    autoFormatTime(document.getElementById("uraanTimeByName"));

    // Save tournament config
    document.getElementById("configForm").addEventListener("submit", e=>{
      e.preventDefault();
      const num=document.getElementById("numPigeons").value;
      localStorage.setItem("tournamentConfig", JSON.stringify({pigeons:num}));
      alert("Config saved");
    });

    // Save heading
    document.getElementById("saveHeadingBtn").addEventListener("click", ()=>{
      const heading=document.getElementById("pageHeadingInput").value;
      localStorage.setItem("pageHeading", heading);
      alert("Heading saved");
    });

    // Save image
    document.getElementById("saveImageBtn").addEventListener("click", ()=>{
      const f=document.getElementById("topImageInput").files[0];
      if(!f)return alert("No file");
      const r=new FileReader();
      r.onload=()=>{localStorage.setItem("topImage", r.result);alert("Image saved");};
      r.readAsDataURL(f);
    });

    // Save global Uraan Ka Time
    document.getElementById("setUraanTimeBtn").addEventListener("click", ()=>{
      const t=document.getElementById("uraanKaTimeInput").value;
      localStorage.setItem("uraanKaTime", t);
      alert("Uraan Ka Time saved");
    });

    // Save time for pigeon
    document.getElementById("saveTimeBtn").addEventListener("click", ()=>{
      const name=document.getElementById("nameSelect").value;
      const t=document.getElementById("pigeonTime").value;
      let rows=JSON.parse(localStorage.getItem("tournamentRows"))||[];
      const row=rows.find(r=>r.name===name);
      if(row){
        row.times=row.times||[];
        row.times.push(t);
      }
      localStorage.setItem("tournamentRows", JSON.stringify(rows));
      alert("Time saved");
    });

    // Save per-name Uraan Ka Time
    document.getElementById("applyUraanTimeByNameBtn").addEventListener("click", ()=>{
      const name=document.getElementById("nameSelect").value;
      const t=document.getElementById("uraanTimeByName").value;
      let rows=JSON.parse(localStorage.getItem("tournamentRows"))||[];
      const row=rows.find(r=>r.name===name);
      if(row){
        row.uraanTimeByName=t;
      }
      localStorage.setItem("tournamentRows", JSON.stringify(rows));
      alert("Uraan Ka Time saved for "+name);
    });

    // Add row
    document.getElementById("addRowForm").addEventListener("submit", e=>{
      e.preventDefault();
      const name=document.getElementById("rowName").value;
      let rows=JSON.parse(localStorage.getItem("tournamentRows"))||[];
      rows.push({name:name,times:[]});
      localStorage.setItem("tournamentRows", JSON.stringify(rows));
      populateNames();
      alert("Row added");
    });

    function populateNames(){
      const sel=document.getElementById("nameSelect");
      sel.innerHTML="";
      let rows=JSON.parse(localStorage.getItem("tournamentRows"))||[];
      rows.forEach(r=>{
        const o=document.createElement("option");
        o.value=r.name; o.textContent=r.name;
        sel.appendChild(o);
      });
    }
    document.addEventListener("DOMContentLoaded", populateNames);

    // âœ… Secure login system
    document.addEventListener("DOMContentLoaded", () => {
      const savedPass = localStorage.getItem("adminPassword");

      // If password already exists, hide "Set Password"
      if (savedPass) {
        document.getElementById("setPasswordBtn").style.display = "none";
      }

      document.getElementById("setPasswordBtn").addEventListener("click", () => {
        const pass = document.getElementById("adminPassword").value;
        if (!pass) return alert("Enter a password");
        if (savedPass) {
          alert("Password is already set. You cannot overwrite it here.");
          return;
        }
        localStorage.setItem("adminPassword", pass);
        alert("Password set successfully. Please login now.");
      });

      document.getElementById("loginBtn").addEventListener("click", () => {
        const pass = document.getElementById("adminPassword").value;
        const saved = localStorage.getItem("adminPassword");
        if (pass === saved) {
          document.getElementById("loginSection").style.display = "none";
          document.getElementById("formSection").style.display = "block";
        } else {
          alert("Wrong password");
        }
      });
    });
  </script>
</body>
</html>
