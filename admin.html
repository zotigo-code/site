<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { text-align: center; margin-bottom: 20px; }
    form { margin-bottom: 20px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    input, select, button { margin-bottom: 10px; padding: 8px; width: 100%; max-width: 400px; }
    button { cursor: pointer; background: #007BFF; color: white; border: none; border-radius: 5px; margin-right: 5px; }
    button:hover { background: #0056b3; }
    #loginSection { margin-bottom: 20px; }
    #formSection { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #f4f4f4; }
  </style>
</head>
<body>
  <h1>Admin Panel</h1>

  <!-- Login Section -->
  <div id="loginSection">
    <h2>Set or Enter Password</h2>
    <input type="password" id="adminPassword" placeholder="Enter password">
    <button id="setPasswordBtn">Set Password</button>
    <button id="loginBtn">Login</button>
  </div>

  <!-- Form Section -->
  <div id="formSection">

    <!-- Tournament Setup -->
    <form id="tournamentForm">
      <label for="pigeonCount">Create Tournament (7, 8, or 11 pigeons):</label>
      <select id="pigeonCount">
        <option value="7">7 Pigeons</option>
        <option value="8">8 Pigeons</option>
        <option value="11">11 Pigeons</option>
      </select>
      <button type="button" id="createTournamentBtn">Create Tournament</button>
    </form>

    <!-- Page Heading -->
    <form>
      <label for="pageHeadingInput">Page Heading:</label>
      <input type="text" id="pageHeadingInput" placeholder="Enter page heading">
      <button type="button" id="setPageHeadingBtn">Set Heading</button>
      <button type="button" id="removePageHeadingBtn" style="background:red;">Remove Heading</button>
    </form>

    <!-- Top Image -->
    <form>
      <label for="imageUpload">Top Image:</label>
      <input type="file" id="imageUpload" accept="image/*">
      <button type="button" id="setImageBtn">Set Image</button>
      <button type="button" id="removeImageBtn" style="background:red;">Remove Image</button>
    </form>

    <!-- Global Uraan Ka Time -->
    <form>
      <label for="uraanTime">Sab Lofts Ka Uraan Ka Time:</label>
      <input type="text" id="uraanTime" placeholder="HHMMSS">
      <button type="button" id="applyUraanTimeBtn">Apply</button>
    </form>

    <!-- Add Row (Name Only) -->
    <form id="addRowForm">
      <label for="rowName">Name:</label>
      <input type="text" id="rowName" placeholder="Enter name">
      <button type="button" id="addRowBtn">Add Row</button>
    </form>

    <!-- Time Registration -->
    <form id="dataForm">
      <label for="nameSelect">Name:</label>
      <select id="nameSelect"></select>

      <label for="uraanTimeByName">Uraan Ka Time:</label>
      <input type="text" id="uraanTimeByName" placeholder="HHMMSS">
      <button type="button" id="applyUraanTimeByNameBtn">Apply Uraan Time</button>

      <label for="pigeonNumber">Pigeon Number:</label>
      <input type="text" id="pigeonNumber" placeholder="Enter pigeon number">

      <label for="timeInput">Time:</label>
      <input type="text" id="timeInput" placeholder="HHMMSS">
      <button type="button" id="submitDataBtn">Submit</button>
    </form>

    <!-- Table -->
    <table id="tournamentTable">
      <thead>
        <tr id="tableHeader"></tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>

  </div>

  <script>
    function autoFormatTime(input) {
      input.addEventListener("input", () => {
        let v = input.value.replace(/\D/g, "").slice(0,6);
        let f = "";
        if(v.length>0) f=v.slice(0,2);
        if(v.length>=3) f+=":"+v.slice(2,4);
        if(v.length>=5) f+=":"+v.slice(4,6);
        input.value=f;
      });
    }

    function archiveCurrentTournament() {
      const rows = JSON.parse(localStorage.getItem("tournamentRows")) || [];
      const config = JSON.parse(localStorage.getItem("tournamentConfig"));
      if (!config) return;
      const archive = JSON.parse(localStorage.getItem("tableHistory")) || [];
      archive.push({
        id: "tournament_" + Date.now(),
        heading: localStorage.getItem("pageHeading") || "Tournament",
        image: localStorage.getItem("topImage") || null,
        uraanKaTime: localStorage.getItem("uraanKaTime") || "00:00:00",
        pigeons: config.pigeons,
        rows: rows
      });
      localStorage.setItem("tableHistory", JSON.stringify(archive));
    }

    function renderNameDropdown() {
      const rows = JSON.parse(localStorage.getItem("tournamentRows")) || [];
      const nameSelect = document.getElementById("nameSelect");
      nameSelect.innerHTML = "";
      rows.forEach(r => {
        const opt = document.createElement("option");
        opt.value = r.name;
        opt.textContent = r.name;
        nameSelect.appendChild(opt);
      });
    }

    function renderTable() {
      const rows = JSON.parse(localStorage.getItem("tournamentRows")) || [];
      const config = JSON.parse(localStorage.getItem("tournamentConfig"));
      if (!config) return;

      const headerRow = document.getElementById("tableHeader");
      const body = document.getElementById("tableBody");
      headerRow.innerHTML = "<th>Name</th><th>Uraan Ka Time</th>";

      for (let i=1; i<=config.pigeons; i++) {
        headerRow.innerHTML += `<th>Pigeon ${i}</th>`;
      }
      headerRow.innerHTML += "<th>Total</th>";

      body.innerHTML = "";
      rows.forEach(r => {
        let tr = document.createElement("tr");
        let total = 0;
        tr.innerHTML = `<td>${r.name}</td><td>${r.uraanTimeByName || "-"}</td>`;
        for (let i=1; i<=config.pigeons; i++) {
          const t = r[`pigeon${i}`] || "-";
          tr.innerHTML += `<td>${t}</td>`;
          if (t !== "-") total++;
        }
        tr.innerHTML += `<td>${total}</td>`;
        body.appendChild(tr);
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      autoFormatTime(document.getElementById("uraanTime"));
      autoFormatTime(document.getElementById("timeInput"));
      autoFormatTime(document.getElementById("uraanTimeByName"));

      // Tournament create
      document.getElementById("createTournamentBtn").addEventListener("click", () => {
        archiveCurrentTournament();
        const pigeons = parseInt(document.getElementById("pigeonCount").value);
        localStorage.setItem("tournamentConfig", JSON.stringify({ pigeons }));
        localStorage.setItem("tournamentRows", JSON.stringify([]));
        alert(`New tournament created with ${pigeons} pigeons.`);
        renderNameDropdown();
        renderTable();
      });

      // Add row
      document.getElementById("addRowBtn").addEventListener("click", () => {
        const name = document.getElementById("rowName").value.trim();
        if (!name) return alert("Enter a name");
        const rows = JSON.parse(localStorage.getItem("tournamentRows")) || [];
        rows.push({ name });
        localStorage.setItem("tournamentRows", JSON.stringify(rows));
        renderNameDropdown();
        renderTable();
      });

      // Apply Uraan Time by Name
      document.getElementById("applyUraanTimeByNameBtn").addEventListener("click", () => {
        const selectedName = document.getElementById("nameSelect").value;
        const uraanTime = document.getElementById("uraanTimeByName").value;
        if (!selectedName) return alert("Select a name");
        const rows = JSON.parse(localStorage.getItem("tournamentRows")) || [];
        const row = rows.find(r => r.name === selectedName);
        if (row) {
          row.uraanTimeByName = uraanTime;
          localStorage.setItem("tournamentRows", JSON.stringify(rows));
          renderTable();
        }
      });

      // Submit pigeon time
      document.getElementById("submitDataBtn").addEventListener("click", () => {
        const selectedName = document.getElementById("nameSelect").value;
        const pigeonNum = document.getElementById("pigeonNumber").value;
        const time = document.getElementById("timeInput").value;
        if (!selectedName || !pigeonNum || !time) return alert("Fill all fields");

        const rows = JSON.parse(localStorage.getItem("tournamentRows")) || [];
        const row = rows.find(r => r.name === selectedName);
        if (row) {
          row[`pigeon${pigeonNum}`] = time;
          localStorage.setItem("tournamentRows", JSON.stringify(rows));
          renderTable();
        }
      });

      // Initial render
      renderNameDropdown();
      renderTable();
    });
  </script>
</body>
</html>
